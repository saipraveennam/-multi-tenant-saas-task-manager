generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Tenant {
  id             String   @id @default(uuid())
  name           String
  subdomain     String   @unique
  status         String   @default("active")
  subscriptionPlan String @default("free")
  maxUsers       Int      @default(5)
  maxProjects    Int      @default(3)
  createdAt      DateTime @default(now())
  updatedAt      DateTime @updatedAt

  users          User[]
  projects       Project[]
  tasks          Task[]
  auditlogs      AuditLog[]

  @@map("tenants")
}

model User {
  id           String   @id @default(uuid())
  tenantId     String?
  email        String   @unique
  passwordHash String
  fullName     String
  role         String
  isActive     Boolean  @default(true)
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt

  tenant       Tenant?      @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  createdProjects Project[] @relation("ProjectCreatedBy")
  assignedTasks   Task[]    @relation("TaskAssignedTo")
  auditlogs       AuditLog[]

  @@map("users")
}

model Project {
  id          String   @id @default(uuid())
  tenantId    String
  name        String
  description String?
  status      String   @default("active")
  createdBy   String?
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  tenant      Tenant   @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  createdByUser User?  @relation("ProjectCreatedBy", fields: [createdBy], references: [id], onDelete: SetNull)
  tasks       Task[]

  @@map("projects")
}

model Task {
  id         String   @id @default(uuid())
  projectId  String
  tenantId   String
  title      String
  description String?
  status     String   @default("todo")
  priority   String   @default("medium")
  assignedTo String?
  dueDate    DateTime?
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt

  project    Project @relation(fields: [projectId], references: [id], onDelete: Cascade)
  tenant     Tenant  @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  assignedToUser User? @relation("TaskAssignedTo", fields: [assignedTo], references: [id], onDelete: SetNull)

  @@map("tasks")
}

model AuditLog {
  id        String   @id @default(uuid())
  tenantId  String?
  userId    String?
  action    String
  entityType String?
  entityId  String?
  ipAddress String?
  createdAt DateTime @default(now())

  tenant    Tenant? @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  user      User?   @relation(fields: [userId], references: [id], onDelete: SetNull)

  @@map("auditlogs")
}
